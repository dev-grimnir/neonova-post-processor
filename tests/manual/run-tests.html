<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Neonova Post-Processor - Manual Tests</title>
  <style>body { font-family: system-ui, sans-serif; padding: 2rem; } .pass { color: green; } .fail { color: red; }</style>
</head>
<body>
  <h1>BaseNeonovaController Tests (Browser)</h1>
  <div id="results"></div>

  <script type="module">
    // Load your source code (use raw.githubusercontent URLs)
    import { BaseNeonovaController } from 'https://raw.githubusercontent.com/dev-grimnir/neonova-post-processor/dev/src/controllers/base-neonova-controller.js';

    const resultsDiv = document.getElementById('results');
    let passCount = 0, total = 0;

    function assert(condition, message) {
      total++;
      const el = document.createElement('p');
      el.textContent = message;
      el.className = condition ? 'pass' : 'fail';
      el.textContent = (condition ? '✓ ' : '✗ ') + message;
      resultsDiv.appendChild(el);
      if (condition) passCount++;
    }

    // Tests
    const ctrl = new BaseNeonovaController();

    // Test 1: getSearchUrl
    const url = ctrl.getSearchUrl('testuser123');
    assert(url.includes('iuserid=testuser123'), 'getSearchUrl includes username');
    assert(url.includes('sday=01'), 'getSearchUrl starts on 1st of month');

    // Test 2: parsePageRows - valid data
    const htmlValid = `
      <table>
        <tr><td>2025-02-03 14:30:00</td><td></td><td></td><td></td><td>Stop</td><td></td><td>00:12:45</td></tr>
        <tr><td>2025-02-03 14:17:15</td><td></td><td></td><td></td><td>Start</td><td></td><td></td></tr>
      </table>`;
    const docValid = new DOMParser().parseFromString(htmlValid, 'text/html');
    const entries = ctrl.parsePageRows(docValid);
    assert(entries.length === 2, 'parses 2 entries');
    assert(entries[0].status === 'Stop', 'first is Stop');
    assert(entries[1].status === 'Start', 'second is Start');

    // Test 3: invalid date skipped
    const htmlInvalid = `<table><tr><td>bad</td><td></td><td></td><td></td><td>Stop</td><td></td><td>00:00:00</td></tr></table>`;
    const docInvalid = new DOMParser().parseFromString(htmlInvalid, 'text/html');
    assert(ctrl.parsePageRows(docInvalid).length === 0, 'skips invalid dates');

    // Summary
    const summary = document.createElement('h2');
    summary.textContent = `${passCount}/${total} tests passed`;
    summary.style.color = passCount === total ? 'green' : 'red';
    resultsDiv.prepend(summary);
  </script>
</body>
</html>
